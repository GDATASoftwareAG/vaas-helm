suite: imagePullSecrets helper
templates:
  - templates/imagepullsecrets-test.yaml

tests:
  - it: renders with object {name}
    values: [values/ok_object.yaml]
    asserts:
      - isKind: { of: Pod }
      - contains:
          path: spec.imagePullSecrets
          content: { name: ghcr-pull }

  - it: renders with global.secret.* only
    values: [values/ok_global_secret.yaml]
    asserts:
      - isKind: { of: Pod }
      - contains:
          path: spec.imagePullSecrets
          content: { name: gateway-global-image-pull-secret }
      - contains:
          path: spec.imagePullSecrets
          content: { name: gateway-global-dockerconfigjson }

  - it: fails on string entry
    values: [values/fail_string.yaml]
    asserts:
      - failedTemplate:
          errorPattern: "must be an object with 'name'"
